@model Zoor_Lebanon.Models.Package
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor

@{
    ViewBag.Title = $"{Model.PackageName} Details";
}

<div class="alert-container">
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success">
            @TempData["SuccessMessage"]
        </div>
    }
    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger">
            @TempData["ErrorMessage"]
        </div>
    }
</div>


<div class="container mt-5">
    <h2 class="text-center mb-4">@Model.PackageName</h2>
    <p>@Model.Description</p>

    <!-- Activity Schedule Section -->
    <h3>Activity Schedule</h3>
    <div class="timeline">
        @foreach (var activity in Model.ActivitySchedules.OrderBy(a => a.FromTime))
        {
            <div class="timeline-item">
                <h4>@activity.Description</h4>
                <p>
                    From: @activity.FromTime?.ToString("hh:mm tt") <br />
                    To: @activity.ToTime?.ToString("hh:mm tt")
                </p>
            </div>
        }
    </div>

    <!-- Reviews Section -->
    <h3>Reviews</h3>
    <div id="reviews-section">
        @if (Model.Reviews.Any(r => r.PublishedStatus == "published"))
        {
            @foreach (var review in Model.Reviews.Where(r => r.PublishedStatus == "published"))
            {
                <div class="review mt-3">
                    <p><strong>@review.User?.Firstname:</strong> @review.ReviewDescription</p>
                    <p>Rating: @review.Rating/5</p>
                </div>
            }
        }
        else
        {
            <p>No reviews yet. Be the first to leave a review!</p>
        }
    </div>

    <!-- Review Submission Form -->
    @if (HttpContextAccessor.HttpContext.Session.GetInt32("UserId") != null)
    {
        <form method="post" action="@Url.Action("SubmitReview", "Review", new { area = "EndUser" })">
            <input type="hidden" name="packageId" value="@Model.PackageId" />
            <div class="form-group">
                <label for="review">Your Review</label>
                <textarea id="review" name="reviewText" class="form-control" rows="3" required></textarea>
            </div>
            <div class="form-group">
                <label for="rating">Rating</label>
                <select id="rating" name="rating" class="form-control" required>
                    @for (int i = 1; i <= 5; i++)
                    {
                        <option value="@i">@i</option>
                    }
                </select>
            </div>
            <button type="submit" class="btn btn-primary mt-3">Submit Review</button>
        </form>
    }
    else
    {
        <p class="text-danger">Please <a href="@Url.Action("Login", "Account", new { area = "EndUser" })">login</a> to leave a review.</p>
    }
</div>

<!-- Style for Timeline -->
<style>
    .timeline {
        margin-top: 20px;
        border-left: 3px solid #007bff;
        padding-left: 20px;
    }

    .timeline-item {
        margin-bottom: 20px;
    }

    .review {
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
    }

    .alert {
        margin-bottom: 20px;
        padding: 15px;
        border: 1px solid transparent;
        border-radius: 4px;
    }

    .alert-success {
        color: #155724;
        background-color: #d4edda;
        border-color: #c3e6cb;
    }

    .alert-danger {
        color: #721c24;
        background-color: #f8d7da;
        border-color: #f5c6cb;
    }
</style>