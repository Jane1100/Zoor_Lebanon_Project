@model Zoor_Lebanon.Models.ViewModels.PackageViewModel


@{
    ViewData["Title"] = "Add New Package - Tour Operator";
}

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success text-center">
        @TempData["SuccessMessage"]
    </div>
}

<!DOCTYPE html>
<html lang="en">
<head>
    <title>Zoor Lebanon - @ViewData["Title"]</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center">Add New Package</h1>
        <form method="post" asp-action="addpackageWithLocation" asp-area="TourOperator" enctype="multipart/form-data" class="mt-4">
            <!-- Package Details -->
            <div class="mb-3">
                <label for="PackageName" class="form-label">Package Name</label>
                <input type="text" id="PackageName" name="Package.PackageName" class="form-control" required />
            </div>
            <div class="mb-3">
                <label for="Description" class="form-label">Description</label>
                <textarea id="Description" name="Package.Description" class="form-control" required></textarea>
            </div>
            <div class="mb-3">
                <label for="UnitPrice" class="form-label">Unit Price ($)</label>
                <input type="number" id="UnitPrice" name="Package.UnitPrice" class="form-control" step="0.01" required />
            </div>
            <div class="mb-3">
                <label for="TotalSpots" class="form-label">Total Spots</label>
                <input type="number" id="TotalSpots" name="Package.TotalSpots" class="form-control" required />
            </div>
            <div class="form-group mb-3">
                <label for="StartDate" class="form-label">Start Date</label>
                <input type="date" id="StartDate" name="Package.StartDate" class="form-control" required />
            </div>
            <div class="form-group mb-3">
                <label for="EndDate" class="form-label">End Date</label>
                <input type="date" id="EndDate" name="Package.EndDate" class="form-control" required />
            </div>
            <div class="mb-3">
                <label for="AverageDuration" class="form-label">Average Duration (hours)</label>
                <input type="number" id="AverageDuration" name="Package.AverageDuration" class="form-control" step="0.01" required />
            </div>
            <div class="mb-3">
                <label for="State" class="form-label">State</label>
                <select id="State" name="State" class="form-select" required>
                    <option value="">Select State</option>
                    @foreach (var state in Model.States)
                    {
                        <option value="@state">@state</option>
                    }
                </select>
            </div>
            <div class="mb-3">
                <label for="City" class="form-label">City</label>
                <select id="City" name="City" class="form-select" required>
                    <option value="">Select City</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="PackageType" class="form-label">Package Type</label>
                <select id="PackageType" name="Package.PackageTypeId" class="form-select" required>
                    <option value="">Select Package Type</option>
                    @foreach (var type in Model.PackageTypes)
                    {
                        <option value="@type.PackageTypeId">@type.PackageType1</option>
                    }
                </select>
            </div>

            <!-- Activity Schedule Section -->
            <div class="mb-4">
                <h4>Activity Schedule</h4>
                <div id="activity-schedule-container">
                    <!-- Initial Activity Input Fields -->
                    <div class="activity-schedule">
                        <div class="mb-3">
                            <label>Activity Description</label>
                            <input type="text" name="ActivitySchedules[0].Description" class="form-control" required />
                        </div>
                        <div class="mb-3">
                            <label>From Time</label>
                            <input type="time" name="ActivitySchedules[0].FromTime" class="form-control" required />
                        </div>
                        <div class="mb-3">
                            <label>To Time</label>
                            <input type="time" name="ActivitySchedules[0].ToTime" class="form-control" required />
                        </div>
                    </div>
                </div>
                <button type="button" id="add-activity-schedule" class="btn btn-secondary">Add Another Activity</button>
            </div>

            <button type="submit" class="btn btn-primary w-100">Submit for Review</button>
        </form>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        $(document).ready(function () {
            let activityCount = 1;

            // Populate City dropdown based on selected State
            $('#State').change(function () {
                const state = $(this).val();
                if (state) {
                    $.getJSON('/TourOperator/Package/GetCitiesByState?state=' + encodeURIComponent(state), function (cities) {
                        const cityDropdown = $('#City');
                        cityDropdown.empty();
                        cityDropdown.append('<option value="">Select City</option>');
                        $.each(cities, function (index, city) {
                            cityDropdown.append('<option value="' + city + '">' + city + '</option>');
                        });
                    });
                }
            });

            // Add activity schedule
            $('#add-activity-schedule').click(function () {
                const container = $('#activity-schedule-container');
                const newActivity = `
                            <div class="activity-schedule">
                                <div class="mb-3">
                                    <label>Activity Description</label>
                                    <input type="text" name="ActivitySchedules[${activityCount}].Description" class="form-control" required />
                                </div>
                                <div class="mb-3">
                                    <label>From Time</label>
                                    <input type="time" name="ActivitySchedules[${activityCount}].FromTime" class="form-control" required />
                                </div>
                                <div class="mb-3">
                                    <label>To Time</label>
                                    <input type="time" name="ActivitySchedules[${activityCount}].ToTime" class="form-control" required />
                                </div>
                                <button type="button" class="btn btn-danger remove-activity-schedule">Remove</button>
                            </div>`;
                container.append(newActivity);
                activityCount++;
            });

            // Remove activity schedule
            $(document).on('click', '.remove-activity-schedule', function () {
                $(this).closest('.activity-schedule').remove();
            });
        });
    </script>
</body>
</html>
